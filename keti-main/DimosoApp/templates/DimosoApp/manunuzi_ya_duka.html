{% extends 'MyProducts/base.html' %}
{% load static %}
{% load i18n %}
{% load crispy_forms_tags %}

{% block content %}

<!DOCTYPE html>
<html>
<head>
    <title>Manunuzi | {{ shop_name }}</title>
    <meta name="viewport" content="width=device-width, initial-scale=1">

    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
</head>
<body>

<div class="container-fluid py-4">
    <div class="row">

        <!-- FILTER + SUMMARY -->
        <div class="col-md-3 mb-4">
            <div class="card shadow p-3 mb-3">
                <h5 class="mb-3">Filter Manunuzi</h5>

                <form method="get">
                    <label>From</label>
                    <input type="date" name="start_date" class="form-control mb-2">

                    <label>To</label>
                    <input type="date" name="end_date" class="form-control mb-3">

                    <button class="btn btn-success w-100">Search</button>
                </form>
            </div>

            <!-- SUMMARY CARD -->
            <div class="card shadow p-3">
                <h6 class="text-success fw-bold mb-3">Muhtasari wa Manunuzi</h6>

                <p class="mb-2">
                    <strong>Jumla ya Manunuzi:</strong><br>
                    <span class="text-success fw-bold">
                        {{ total_amount }} TZS
                    </span>
                </p>

                <p class="mb-0">
                    <strong>Jumla ya Bidhaa Zilizonunuliwa:</strong><br>
                    <span class="text-primary fw-bold">
                        {{ total_items }}
                    </span>
                </p>
            </div>
        </div>

        <!-- TABLE -->
        <div class="col-md-9">
            <div class="d-flex justify-content-between align-items-center mb-3">
                <div>
                    <h4>Manunuzi Duka la - {{ shop_name }}</h4>
                    <p class="text-muted mb-0">
                        {% if request.GET.start_date %}
                            Kuanzia {{ request.GET.start_date }}
                            {% if request.GET.end_date %} hadi {{ request.GET.end_date }} {% endif %}
                        {% else %}
                            Manunuzi ya Leo: {{ today }}
                        {% endif %}
                    </p>
                </div>

                <!-- ACTION BUTTON -->
                <a href="{% url 'export_manunuzi_excel' shop_name %}"
                   class="btn btn-outline-success">
                    Export Excel
                </a>
            </div>

            <table class="table table-bordered table-striped shadow">
                <thead class="table-success">
                    <tr>
                        <th>#</th>
                        <th>Bidhaa</th>
                        <th>Kiasi</th>
                        <th>Hela (TZS)</th>
                        <th>Imenunuliwa Na</th>
                        <th>Tarehe</th>
                    </tr>
                </thead>
                <tbody>
                    {% for item in manunuzi %}
                    <tr>
                        <td>{{ forloop.counter }}</td>
                        <td>{{ item.JinaLaBidhaa }}</td>
                        <td>{{ item.KiasiChaBidhaaUlichonunua }}</td>
                        <td>{{ item.HelaUliyotoa }}</td>
                        <td>{{ item.ImenunuliwaNa }}</td>
                        <td>{{ item.Created|date:"d-m-Y H:i" }}</td>
                    </tr>
                    {% empty %}
                    <tr>
                        <td colspan="6" class="text-center text-danger">
                            Hakuna manunuzi yaliyopatikana
                        </td>
                    </tr>
                    {% endfor %}
                </tbody>
            </table>

        </div>
    </div>
</div>

</body>
</html>

{% endblock %}
